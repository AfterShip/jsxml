/*
 * Copyright 2011 http://colorhook.com.
 * @author: <a href="colorhook@gmail.com">colorhook</a>
 * @version:0.1.0
 */
var jsxml=(function(){var n=/^<([a-zA-Z\$_]+:{0,1}[a-zA-Z0-9\$\-_]*)((?:\s+[a-zA-Z\$_]+:{0,1}[a-zA-Z0-9\$\-_]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,f=/^<\/([a-zA-Z0-9\$\-_:]+)[^>]*>/,j=/([a-zA-Z\$_]+:{0,1}[a-zA-Z0-9\$\-_]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,b,c,m,o,g,e,h,d,l,i,k,a;c=String.prototype.trim?function(p){return p&&p.trim?p.trim():p}:function(p){try{return p.replace(/^\s+|\s+$/,"")}catch(q){return p}};m=function(r,p){for(var q in p){if(p.hasOwnProperty(q)){r[q]=p[q]}}if(!-[1,]){if(p.toString!==Object.prototype){r.toString=p.toString}}};arrayIndexOf=function(s,r){if(s.indexOf){return s.indexOf(r)}for(var q=0,p=s.length;q<p;q++){if(r===s[q]){return q}}return -1};o=function(p){return p.match(/&(amp|lt|gt);/)};g=function(p){p=p.replace(/&[^(amp;|lt;|gt;)]/g,"&amp;");p=p.replace(/</g,"&lt;");p=p.replace(/>/g,"&gt;");return p};e=function(p){p=p.replace(/&lt;/g,"<");p=p.replace(/&gt;/g,">");p=p.replace(/&amp;/g,"&");return p};b=function(q,y){var t,u,r,v=[],w=q;v.last=function(){return this[this.length-1]};while(q){u=true;if(q.indexOf("<![CDATA[")==0){t=q.indexOf("]]>");if(t>0){x=q.substring(9,t);if(y.chars){y.chars(x,true)}q=q.substring(t+3)}u=false}else{if(q.indexOf("<?")==0){t=q.indexOf("?>");if(t>0){x=q.substr(2,t-2);if(y.instruction){y.instruction(x)}q=q.substring(t+2)}u=false}else{if(q.indexOf("<!--")==0){t=q.indexOf("-->");if(t>=0){if(y.comment){y.comment(q.substring(4,t))}q=q.substring(t+3);u=false}}else{if(q.indexOf("</")==0){r=q.match(f);if(r){q=q.substring(r[0].length);r[0].replace(f,s);u=false}}else{if(q.indexOf("<")==0){r=q.match(n);if(r){q=q.substring(r[0].length);r[0].replace(n,p);u=false}}}}}}if(u){t=q.indexOf("<");var x=t<0?q:q.substring(0,t);q=t<0?"":q.substring(t);if(y.chars){y.chars(x)}}if(q==w){throw"Parse Error: "+q}w=q}s();function p(z,C,D,A){A=!!A;if(!A){v.push(C)}if(y.start){var B=[];D.replace(j,function(F,E){var G=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:E?E:"";B.push({name:E,value:G,escaped:G.replace(/(^|[^\\])"/g,'$1\\"')})});if(y.start){y.start(C,B,A)}}}function s(z,B){if(!B){var C=0}else{for(var C=v.length-1;C>=0;C--){if(v[C]==B){break}}}if(C>=0){for(var A=v.length-1;A>=C;A--){if(y.end){y.end(v[A])}}v.length=C}}};h=function(r,q){var p=arguments.length;if(p>=2){this.prefix=String(r);this.uri=String(q)}else{if(p==1){this.prefix="";this.uri=String(r)}else{this.prefix="";this.uri=""}}};h.prototype={constructor:h,toString:function(){return this.uri},copy:function(){var p=new h();p.prefix=this.prefix;p.uri=this.uri;return p},equals:function(p){return this.prefix===p.prefix&&this.uri===p.uri}};d=function(r,q){var p=arguments.length;if(p>=2){this.uri=String(r);this._ns=(r&&r.constructor==h)?r:new h(r);this.localName=String(q)}else{if(p==1){this.uri="";this._ns=new h();this.localName=String(r)}else{this.uri="";this._ns=new h();this.localName=""}}};d.prototype={constructor:d,toString:function(){var p=this.uri?this.uri+"::":"";return p+this.localName},copy:function(){var p=new d();p.uri=this.uri;p.localName=this.localName;p._ns=this._ns.copy();return p},equals:function(p){return this.localName==p.localName&&this._ns.equals(p._ns)}};d._format=function(r,t){var q=r.split(":"),s,p;if(q.length==2){s=q[0];p=q[1]}else{s="";p=r}return new d(new h(s,t),p)};l={ELEMENT:"element",COMMENT:"comment",PROCESSING_INSTRUCTIONS:"processing-instructions",TEXT:"text",ATTRIBUTE:"attribute"};i=function(p){if(p._list&&p.length()==1){return i(p._list[0])}return p};k=function(){this._list=[]};m(k.prototype,{constructor:k,_addXML:function(p){if(p.constructor==a){this._list.push(p)}else{if(p.constructor==k){this._list=this._list.concat(p._list)}}return this},length:function(){return this._list.length},childIndex:function(){throw new Error("this method only availabe in single list XML")},child:function(r){var q=new k();this.each(function(p){var s=p.child(r);if(s.length()){q._addXML(s)}});return i(q)},children:function(){return this.child("*")},attribute:function(r){var q=new k();this.each(function(p){q._addXML(p.attribute(r))});return i(q)},attributes:function(q){return this.attribute("*")},elements:function(r){var q=new k();this.each(function(p){q._addXML(p.elements(r))});return i(q)},descendants:function(r){var q=new k();this.each(function(p){q._addXML(p.descendants(r))});return i(q)},normalize:function(){this.each(function(p){p.normalize()})},hasSimpleContent:function(){for(var q=0,p=this._list.length;q<p;q++){var r=this._list[q];if(r.constructor==k||r.hasComplexContent()){return false}}return true},hasComplexContent:function(){return !this.hasSimpleContent()},text:function(){var p=new k();this.each(function(r){if(r.constructor==a){var q=r.text();if(q._text!=""){p._addXML(q)}}});return i(p)},comments:function(){var p=new k();this.each(function(q){if(q.constructor==a){p._addXML(q.comments())}});return i(p)},processingInstructions:function(){var p=new k();this.each(function(q){if(q.constructor==a){p._addXML(q.processingInstructions())}});return i(p)},copy:function(){var p=new k();this.each(function(r,q){p._list[q]=r.copy()});return p},toXMLString:function(){var p=[];this.each(function(q){p.push(q.toXMLString())});return p.join("\n")},toString:function(){var p="";this.each(function(q){p+=q.toString()});return p},item:function(p){return this._list[p]},each:function(r){for(var q=0,p=this._list.length;q<p;q++){r(this._list[q],q,this)}}});a=function(r){this._children=[];this._attributes=[];this._namespaces=[];this._nodeKind=l.ELEMENT;this._qname=null;this._parent=null;this._text=null;this._useCDATA=false;var q,p=this;if(r){b(r,{start:function(A,z,s){var v;if(!q){v=p}else{v=new a();v._parent=q}v._qname=d._format(A);for(var u in z){var x=new a();x._nodeKind=l.ATTRIBUTE;var t;if(z[u].name==="xmlns"){t=new d(new h("xmlns",z[u].value),"")}else{t=d._format(z[u].name,z[u].value)}var w=t._ns.prefix||"";if(w==="xmlns"){var y=new h(t.localName,t.uri);v.addNamespace(y);if(t.localName==v._qname._ns.prefix){v.setNamespace(y)}}else{x._qname=t;x._text=z[u].value;v._attributes.push(x)}}q=v;if(s){this.end(A)}},chars:function(u,s){u=c(u);if(u==""&&a.ignoreWhitespace){return}var t=new a();t._nodeKind=l.TEXT;t._text=u;t._useCDATA=s;q._children.push(t)},end:function(s){if(q&&q._parent){q._parent._children.push(q);q=q._parent}else{if(q==p){q=null}}},comment:function(t){var s=new a();s._nodeKind=l.COMMENT;s._text=t;q&&q._children.push(s)},instruction:function(t){var s=new a();s._nodeKind=l.PROCESSING_INSTRUCTIONS;s._text=t;q&&q._children.push(s)}})}};m(a.prototype,{addNamespace:function(p){if(p.prefix!=undefined){this.removeNamespace(p);this._namespaces.push(p)}},removeNamespace:function(r){for(var q=0,p=this._namespaces.length;q<p;q++){if(r.prefix==this._namespaces[q].prefix){this._namespaces.splice(q,1);break}}},namespace:function(r){if(!r){return new h()}for(var q=0,p=this._namespaces.length;q<p;q++){if(r==this._namespaces[q].prefix){return this._namespaces[q]}}return undefined},setNamespace:function(p){if(p&&p.constructor==h){this.addNamespace(p);if(this._qname){this._qname.uri=p.uri;this._qname._ns=p}}},namespaceDeclarations:function(){return this._namespaces},inScopeNamespaces:function(){var q=this._namespaces;var p=this._parent;while(p){q=p.inScopeNamespaces().concat(q);p=p._parent}return q},nodeKind:function(){return this._nodeKind},name:function(){if(!this._qname){return null}if(this._qname.uri){return this._qname.uri+":"+this._qname.localName}return this._qname.localName},localName:function(){if(!this._qname){return null}return this._qname.localName},setName:function(p){if(this._qname==null){return}if(/^[a-zA-Z]+[a-zA-Z0-9]*$/.test(p)){this._qname.uri="";this._qname.localName=p}else{throw new Error("invalid value for XML name")}},setLocalName:function(p){if(this._qname==null){return}if(/^[a-zA-Z\$_]+[a-zA-Z0-9\$\-_]*$/.test(p)){this._qname.localName=p}else{throw new Error("invalid value for XML localName")}},length:function(){return 1},attribute:function(v){var r=this._attributes,s,q,t,u=new k();for(s=0,q=r.length;s<q;s++){t=r[s];if(t._qname.localName==v||v=="*"){u._addXML(t)}}return i(u)},attributes:function(){return this.attribute("*")},_createTextNode:function(q){var p=new a();p._nodeKind=l.TEXT;p._text=q;p._useCDATA=/['"<>&]/.test(q);return p},appendChild:function(r){var q=r.constructor;if(q==a){r._parent=this;this._children.push(r)}else{if(q==k){r.each(function(s){s._parent=this});this._children=this._children.concat(r._list)}else{if(q==String){var p=this._createTextNode(r);p._parent=this;this._children.push(p)}}}return this},prependChild:function(r){var q=r.constructor;if(q==a){r._parent=this;this._children.unshift(r)}else{if(q==k){r.each(function(s){s._parent=this});this._children=this._list.concat(this._children)}else{if(q===String){var p=this._createTextNode(r);p._parent=this;this._children.unshift(p)}}}return this},normalize:function(){var s,p,t,r=this._children,v=[];for(s=0,p=r.length;s<p;s++){var u=r[s],q=u.nodeKind();if(q==l.TEXT){if(t){u._text=t._text+u._text;r[s-1]=null}t=u}else{if(q==l.ELEMENT){u.normalize();t=null}}}for(s=0,p=r.length;s<p;s++){r[s]&&v.push(r[s])}this._children=v},_getFilterChildren:function(){var s,p,u=[],r=this._children;for(s=0,p=r.length;s<p;s++){var t=r[s],q=t.nodeKind();if(q==l.ELEMENT||q==l.TEXT||(q==l.COMMENT&&!a.ignoreComments)||(q==l.PROCESSING_INSTRUCTIONS&&!a.ignoreProcessingInstructions)){u.push(t)}}return u},child:function(u){var t=new k(),s,q,v=this._getFilterChildren();if(typeof u=="number"){if(v.length!=0&&v[u]){t._addXML(v[u])}}else{for(s=0,q=v.length;s<q;s++){var r=v[s];if(r.localName()==u||u=="*"){t._addXML(r)}}}return i(t)},childIndex:function(q){if(this._parent){return arrayIndexOf(this._parent._getFilterChildren(),this)}return -1},children:function(){return this.child("*")},setChildren:function(p){this._children=[];return this.appendChild(p)},replace:function(y,x){var z=-1,u,s,w=this._children,q=[];for(u=0,s=w.length;u<s;u++){var v=w[u],p=v.nodeKind();if((v.localName()==y||y=="*")&&p==l.ELEMENT){if(z==-1){z=u;var r=x.constructor;if(r==a){x._parent=this;q.push(x)}else{if(r==k){x.each(function(t){t._parent=this});q=q.concat(x._list)}else{if(r===String){var A=this._createTextNode(x);A._parent=this;q.push(A)}}}}}else{q.push(v)}}if(z!=-1){this._children=q;this.normalize()}return this},elements:function(u){if(arguments.length==0){u="*"}var t=new k(),s,q,v=this._children;for(s=0,q=v.length;s<q;s++){var r=v[s];if((r.localName()==u||u=="*")&&r.nodeKind()==l.ELEMENT){t._addXML(r)}}return i(t)},descendants:function(v){if(arguments.length==0){v="*"}var u=new k(),t,q,w=this._children;for(t=0,q=w.length;t<q;t++){var s=w[t],r=s.nodeKind();if((s.localName()==v||v=="*")&&(r==l.ELEMENT||r==l.TEXT)){u._addXML(s)}if(s._nodeKind==l.ELEMENT){u._addXML(s.descendants(v))}}return i(u)},insertChildBefore:function(s,r){if(s==null){return this.appendChild(r)}if(s.constructor!=a){return undefined}var t=s.childIndex();if(s._parent==this&&t!=-1){if(r.constructor==a){r._parent=this;this._children.splice(t,0,r)}else{if(r.constructor==k){for(var q=0,p=r._list.length;q<p;q++){r._list[q]._parent=this;this._children.splice(t+q,0,r._list[q])}}else{return undefined}}return this}else{return undefined}},insertChildAfter:function(s,r){if(s==null){return this.prependChild(r)}if(s.constructor!=a){return undefined}var t=s.childIndex();if(s._parent==this&&t!=-1){if(r.constructor==a){r._parent=this;this._children.splice(t+1,0,r)}else{if(r.constructor==k){for(var q=0,p=r._list.length;q<p;q++){r._list[q]._parent=this;this._children.splice(t+1+q,0,r._list[q])}}else{return undefined}}return this}else{return undefined}},parent:function(){return this._parent},hasSimpleContent:function(){var s=this._children;for(var r=0,p=s.length;r<p;r++){var q=s[r].nodeKind();if(q===l.ELEMENT){return false}}return true},hasComplexContent:function(){return !this.hasSimpleContent()},comments:function(){var s=new k(),r,p,t=this._getFilterChildren();for(r=0,p=t.length;r<p;r++){var q=t[r];if(q.nodeKind()==l.COMMENT){s._addXML(q)}}return i(s)},text:function(){var u=this._children,t="";for(var s=0,p=u.length;s<p;s++){var q=u[s].nodeKind();if(q===l.TEXT){if(u[s]._useCDATA){t+=u[s]._text}else{t+=e(u[s]._text)}}}return this._createTextNode(t)},comments:function(){var s=new k(),r,p,t=this._getFilterChildren();for(r=0,p=t.length;r<p;r++){var q=t[r];if(q.nodeKind&&q.nodeKind()==l.COMMENT){s._addXML(q)}}return i(s)},processingInstructions:function(){var s=new k(),r,p,t=this._getFilterChildren();for(r=0,p=t.length;r<p;r++){var q=t[r];if(q.nodeKind&&q.nodeKind()==l.PROCESSING_INSTRUCTIONS){s._addXML(q)}}return i(s)},copy:function(){var q=new a(),r,p;q._nodeKind=this._nodeKind;q._text=this._text;q._useCDATA=this._useCDATA;if(this._qname){q._qname=this._qname.copy()}for(r=0,p=this._namespaces.length;r<p;r++){q._namespaces[r]=this._namespaces[r].copy()}for(r=0,p=this._attributes.length;r<p;r++){q._attributes[r]=this._attributes[r].copy()}for(r=0,p=this._children.length;r<p;r++){q._children[r]=this._children[r].copy()}return q},_toXMLString:function(x,C){var G="",H,A,y,t=this._nodeKind,D=C?this.inScopeNamespaces():this._namespaces,F=this._attributes,w=this._children,z=a.prettyPrinting,u=[];x=x||0;if(z){for(A=0;A<x;A++){G+=" "}}if(t==l.ATTRIBUTE){return G+this._text}else{if(t==l.TEXT){if(this._useCDATA){return G+"<![CDATA["+this._text+"]]>"}else{return G+g(this._text)}}else{if(t==l.COMMENT){return G+"<!--"+this._text+"-->"}else{if(t==l.PROCESSING_INSTRUCTIONS){return G+"<?"+this._text+"?>"}}}}if(this._qname._ns.prefix){H=this._qname._ns.prefix+":"+this.localName()}else{H=this.localName()}G+="<"+H;for(A=0,y=D.length;A<y;A++){var B=D[A].prefix?"xmlns:"+D[A].prefix:"xmlns";u.push({label:B,value:D[A].uri})}for(A=0,y=F.length;A<y;A++){var r=F[A]._qname,B=r._ns.prefix,E;if(B){E=B+":"+r.localName}else{E=r.localName}u.push({label:E,value:F[A]._text})}if(u.length>0){for(A=0,y=u.length;A<y;A++){G+=" "+u[A].label+'="'+u[A].value+'"'}}u=[];for(A=0,y=w.length;A<y;A++){var v=w[A];if(v.nodeKind()==l.ELEMENT){u.push(v)}else{if(v.nodeKind()==l.COMMENT&&!a.ignoreComments){u.push(v)}else{if(v.nodeKind()==l.PROCESSING_INSTRUCTIONS&&!a.ignoreProcessingInstructions){u.push(v)}else{if(v.nodeKind()==l.TEXT){u.push(v)}}}}}if(u.length==0){G+="/>"}else{if(u.length==1&&u[0].nodeKind()==l.TEXT){G+=">";G+=u[0]._toXMLString(0);G+="</"+H+">"}else{G+=">";for(A=0,y=u.length;A<y;A++){if(z){G+="\n"}G+=u[A]._toXMLString(x+a.prettyIndent)}if(z){G+="\n";for(A=0;A<x;A++){G+=" "}}G+="</"+H+">"}}return G},toXMLString:function(){return this._toXMLString(0,true)},toString:function(){if(this.hasComplexContent()){return this.toXMLString()}if(this.nodeKind()==l.TEXT||this.nodeKind()==l.ATTRIBUTE){return this._text}var t="";for(var q=0,p=this._children.length;q<p;q++){var r=this._children[q];if(r._nodeKind==l.TEXT){if(r._useCDATA){t+=r._text}else{t+=e(r._text)}}}return t},getValue:function(){var p=this._nodeKind;if(p==l.TEXT){if(!this._useCDATA&&o(this._text)){return e(this._text)}return this._text}else{if(p==l.ATTRIBUTE){return this._text}else{if(p==l.ELEMENT&&this.hasSimpleContent()){var q=this.text();if(q.getValue){return q.getValue()}}}}return undefined},setValue:function(u){var q=this._nodeKind;if(q==l.TEXT||q==l.ATTRIBUTE||q==l.COMMENT||q==l.PROCESSING_INSTRUCTIONS){this._text=u}else{if(q==l.ELEMENT&&this.hasSimpleContent()){var v=[],t=this._createTextNode(u);t._parent=this;v.push(t);for(var r=0,p=this._children.length;r<p;r++){var s=this._children[r];if(s._nodeKind!=l.TEXT){v.push(s)}}this._children=v}}return this}});m(a,{ignoreComments:true,ignoreProcessingInstructions:true,ignoreWhitespace:true,prettyIndent:2,prettyPrinting:true,settings:function(){return{ignoreComments:this.ignoreComments,ignoreProcessingInstructions:this.ignoreProcessingInstructions,ignoreWhitespace:this.ignoreWhitespace,prettyIndent:this.prettyIndent,prettyPrinting:this.prettyPrinting}},setSettings:function(q){if(!q){return}var p=function(r){if(q.hasOwnProperty(r)){a[r]=q[r]}};p("ignoreComments");p("ignoreProcessingInstructions");p("ignoreWhitespace");p("prettyIndent");p("prettyPrinting")}});return{containsEntity:o,replaceToEntity:g,replaceFromEntity:e,parseXML:b,Namespace:h,QName:d,NodeKind:l,XMLList:k,XML:a}})();